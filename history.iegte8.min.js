/*!
 * History API JavaScript Library v4.0.6
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome and other
 *
 * Copyright 2011-2013, Dmitrii Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 2013-10-10 17:16
 */
(function(f){function D(){}function k(a,b,c){if(a&&!b){b=k();c=b.d;var e=b.h;a=/^(?:[\w0-9]+\:)?\/\//.test(a)?0===a.indexOf("/")?e+a:a:e+"//"+b.g+(0===a.indexOf("/")?a:0===a.indexOf("?")?c+a:0===a.indexOf("#")?c+b.e+a:c.replace(/[^\/]+$/g,"")+a)}else if(a=b?a:d.href,!p||c)a=a.replace(/^[^#]*/,"")||"#",a=d.protocol+"//"+d.host+l.basepath+a.replace(RegExp("^#[/]?(?:"+l.type+")?"),"");I.href=a;a=/(?:([\w0-9]+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/.exec(I.href);
b=a[2]+(a[3]?":"+a[3]:"");c=a[4]||"/";var e=a[5]||"",f="#"===a[6]?"":a[6]||"",g=c+e+f,h=c.replace(RegExp("^"+l.basepath,"i"),l.type)+e;return{b:a[1]+"//"+b+g,h:a[1],g:b,i:a[2],k:a[3]||"",d:c,e:e,a:f,c:g,j:h,f:h+f}}function W(){var a="";if(t)a+=t.getItem(x);else{var b=g.cookie.split(x+"=");1<b.length&&(a+=b.pop().split(";").shift()||"null")}try{m=y.parse(a)||{}}catch(c){m={}}n(r+"unload",function(){if(t)t.setItem(x,y.stringify(m));else{var a={};if(a[d.href]=h.state)g.cookie=x+"="+y.stringify(a)}},
!1)}function z(a,b,c,e){c=c||{set:D};var d=!c.set,g=!c.get,h={configurable:!0,set:function(){d=1},get:function(){g=1}};try{u(a,b,h),a[b]=a[b],u(a,b,c)}catch(k){}if(!d||!g)if(a.__defineGetter__&&(a.__defineGetter__(b,h.get),a.__defineSetter__(b,h.set),a[b]=a[b],c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)),!(d&&g||a!==f)){try{var l=a[b];a[b]=null}catch(p){}if("execScript"in f)f.execScript("Public "+b,"VBScript");else try{u(a,b,{value:D})}catch(q){}a[b]=l}else if(!d||!g)try{try{var m=
E.create(a);u(E.getPrototypeOf(m)===a?m:a,b,c);for(var n in a)"function"===typeof a[n]&&(m[n]=a[n].bind(a));try{e.call(m,m,a)}catch(r){}a=m}catch(s){u(a.constructor.prototype,b,c)}}catch(t){return!1}return a}function X(a,b,c){c=c||{};a=a===J?d:a;c.set=c.set||function(c){a[b]=c};c.get=c.get||function(){return a[b]};return c}function Y(a,b,c){a in s?s[a].push(b):3<arguments.length?n(a,b,c,arguments[3]):n(a,b,c)}function Z(a,b,c){var e=s[a];if(e)for(a=e.length;--a;){if(e[a]===b){e.splice(a,1);break}}else K(a,
b,c)}function A(a,b){var c=(""+("string"===typeof a?a:a.type)).replace(/^on/,""),e=s[c];if(e){b="string"===typeof a?b:a;if(null==b.target)for(var d=["target","currentTarget","srcElement","type"];a=d.pop();)b=z(b,a,{get:"type"===a?function(){return c}:function(){return f}});(("popstate"===c?f.onpopstate:f.onhashchange)||D).call(f,b);for(var d=0,g=e.length;d<g;d++)e[d].call(f,b);return!0}return $(a,b)}function L(){var a=g.createEvent?g.createEvent("Event"):g.createEventObject();a.initEvent?a.initEvent("popstate",
!1,!1):a.type="popstate";a.state=h.state;A(a)}function v(a,b,c,e){p||(b=k(b),b.c!==k().c&&(w=e,c?d.replace("#"+b.f):d.hash=b.f));!B&&a&&(m[d.href]=a);C=!1}function M(a){if(w){N!==d.href&&L();a=a||f.event;var b=k(w,!0),c=k();a.oldURL||(a.oldURL=b.b,a.newURL=c.b);b.a!==c.a&&A(a)}w=d.href}function O(a){setTimeout(function(){n("popstate",function(a){N=d.href;B||(a=z(a,"state",{get:function(){return h.state}}));A(a)},!1)},0);!p&&!0!==a&&h.location&&(P(h.location.hash),C&&(C=!1,L()))}function aa(a){a=a||
f.event;var b;a:{for(b=a.target||a.srcElement;b;){if("A"===b.nodeName)break a;b=b.parentNode}b=void 0}var c="defaultPrevented"in a?a.defaultPrevented:!1===a.returnValue;b&&"A"===b.nodeName&&!c&&(c=k(),b=k(b.getAttribute("href",2)),c.b.split("#").shift()===b.b.split("#").shift()&&b.a&&(c.a!==b.a&&(h.location.hash=b.a),P(b.a),a.preventDefault?a.preventDefault():a.returnValue=!1))}function P(a){var b=g.getElementById(a=(a||"").replace(/^#/,""));b&&b.id===a&&"A"===b.nodeName&&(a=b.getBoundingClientRect(),
f.scrollTo(F.scrollLeft||0,a.top+(F.scrollTop||0)-(F.clientTop||0)))}function ba(){var a=g.getElementsByTagName("script"),a=(a[a.length-1]||{}).src||"";(-1!==a.indexOf("?")?a.split("?").pop():"").replace(/(\w+)(?:=([^&]*))?/g,function(a,b,c){l[b]=(c||("basepath"===b?"/":"")).replace(/^(0|false)$/,"")});try{t=f.sessionStorage}catch(b){}n(r+"hashchange",M,!1);var c=[J,Q,ca,f,R,h];B&&delete R.state;for(var e=0;e<c.length;e+=2)for(var d in c[e])if(c[e].hasOwnProperty(d))if("function"===typeof c[e][d])c[e+
1][d]=c[e][d];else{a=X(c[e],d,c[e][d]);if(!z(c[e+1],d,a,function(a,b){b===h&&(f.history=h=c[e+1]=a)}))return K(r+"hashchange",M,!1),!1;c[e+1]===f&&(s[d]=s[d.substr(2)]=[])}l.redirect&&h.redirect();!B&&y&&W();if(!p)g[G](r+"click",aa,!1);"complete"===g.readyState?O(!0):(p||k().c===l.basepath||(C=!0),n(r+"load",O,!1));return!0}if(f.history){var g=f.document,F=g.documentElement,t=null,E=f.Object,y=f.JSON,d=f.location,q=f.history,h=q,H=q.pushState,S=q.replaceState,p=!!H,B="state"in q,u=E.defineProperty,
Q=z({},"t")?{}:g.createElement("a"),r="",G=f.addEventListener?"addEventListener":(r="on")&&"attachEvent",T=f.removeEventListener?"removeEventListener":"detachEvent",U=f.dispatchEvent?"dispatchEvent":"fireEvent",n=f[G],K=f[T],$=f[U],l={basepath:"/",redirect:0,type:"/"},x="__historyAPI__",I=g.createElement("a"),w=d.href,N="",C=!1,m={},s={},ca={onhashchange:null,onpopstate:null},V=function(a,b){var c=f.history!==q;c&&(f.history=q);a.apply(q,b);c&&(f.history=h)},R={redirect:function(a,b){l.basepath=b=
null==b?l.basepath:b;l.type=a=null==a?l.type:a;if(f.top==f.self){var c=k(null,!1,!0).c,e=d.pathname+d.search;p?(e=e.replace(/([^\/])$/,"$1/"),c!=b&&RegExp("^"+b+"$","i").test(e)&&d.replace(c)):e!=b&&(e=e.replace(/([^\/])\?/,"$1/?"),RegExp("^"+b,"i").test(e)&&d.replace(b+"#"+e.replace(RegExp("^"+b,"i"),a)+d.hash))}},pushState:function(a,b,c){H&&V(H,arguments);v(a,c)},replaceState:function(a,b,c){delete m[d.href];S&&V(S,arguments);v(a,c,!0)},location:{set:function(a){f.location=a},get:function(){return p?
d:Q}},state:{get:function(){return m[d.href]||null}}},J={assign:function(a){0===(""+a).indexOf("#")?v(null,a):d.assign(a)},reload:function(){d.reload()},replace:function(a){0===(""+a).indexOf("#")?v(null,a,!0):d.replace(a)},toString:function(){return this.href},href:{get:function(){return k().b}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return k().d}},search:{get:function(){return k().e}},hash:{set:function(a){v(null,(""+a).replace(/^(#|)/,"#"),!1,w)},get:function(){return k().a}}};
ba()&&(h.emulate=!p,f[G]=Y,f[T]=Z,f[U]=A)}})(window);
